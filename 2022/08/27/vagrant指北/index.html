<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1,user-scalable=no"><meta name="renderer" content="webkit"><meta name="color-scheme" content="dark light"><meta name="author" content="ainexur"><meta name="description" content="温故 知新"><meta name="keywords" content="博客"><title>vagrant指北</title><link rel="icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="//at.alicdn.com/t/font_3242539_utq6ykfq7z.css"><link rel="stylesheet" light-src="https://cdn.staticfile.org/highlight.js/11.5.0/styles/default.min.css" dark-src="https://cdn.staticfile.org/highlight.js/11.5.0/styles/tokyo-night-dark.min.css"><link rel="stylesheet" href="https://fonts.font.im/css?family=Noto+Serif" as="font"><link href="/style/index.css" rel="stylesheet"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="寻人启事" type="application/atom+xml">
</head><body><header class="page-header"><nav><ul class="router-list"><li class="nav-item"> <a href="/">主页</a></li><li class="nav-item"> <a href="/archives/">归档</a></li><li class="nav-item"> <a href="/atom.xml">RSS</a></li></ul><div class="mode-switch"><span class="iconfont icon-DarkTheme"></span></div></nav></header><main><section class="main-content"><section class="post-page"><div class="title-bar"><h1>vagrant指北</h1><div class="post-info"><span>2022-08-27 12:36:37</span><span class="tags"><a href="/tags/vagrant/">#vagrant</a></span></div></div><article> <div class="content"><h2 id="Vagrant安装-amp-配置"><a href="#Vagrant安装-amp-配置" class="headerlink" title="Vagrant安装&amp;配置"></a>Vagrant安装&amp;配置</h2><ul>
<li><p>An error occurred while downloading the remote file. The error message, if any, is reproduced below. Please fix this error and try again</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/gongzi_9/article/details/123058281">csdn</a></p>
</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>可通过<a target="_blank" rel="noopener" href="https://developer.hashicorp.com/vagrant/downloads">官网下载安装地址</a>下载安装。</p>
<h3 id="windows10安装"><a href="#windows10安装" class="headerlink" title="windows10安装"></a>windows10安装</h3><p>选择AMD64版本，下载得到exe文件后双击打开安装即可。</p>
<img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" 
  class="img-loading" data-original="https://typoradrawingbed.oss-cn-guangzhou.aliyuncs.com/img/image-20230319214628259.png"" alt="image-20230319214628259" style="zoom: 33%;" />		

<h3 id="验证安装"><a href="#验证安装" class="headerlink" title="验证安装"></a>验证安装</h3><p>控制台输入<code>vagrant -v</code>查看版本，可验证是否安装完成，正常输出版本如下：例如我的版本是2.3.4</p>
<img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" 
  class="img-loading" data-original="https://typoradrawingbed.oss-cn-guangzhou.aliyuncs.com/img/image-20230319215133740.png"" alt="image-20230319215133740" style="zoom: 67%;" />	

<h2 id="配置VMware插件"><a href="#配置VMware插件" class="headerlink" title="配置VMware插件"></a>配置VMware插件</h2><h3 id="安装vagrant-vmware-desktop"><a href="#安装vagrant-vmware-desktop" class="headerlink" title="安装vagrant-vmware-desktop"></a>安装vagrant-vmware-desktop</h3><p><a target="_blank" rel="noopener" href="https://developer.hashicorp.com/vagrant/docs/providers/vmware/installation">官网文档</a></p>
<blockquote>
<p>前提：安装完成vagrant后</p>
</blockquote>
<p>执行命令安装vmware插件</p>
<pre><code class="hljs shell">vagrant plugin install vagrant-vmware-desktop</code></pre>

<p>稍等几分钟后出现如下提示则安装完成</p>
<img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" 
  class="img-loading" data-original="https://typoradrawingbed.oss-cn-guangzhou.aliyuncs.com/img/image-20230319224920262.png"" alt="image-20230319224920262" style="zoom:50%;" />	

<h3 id="安装Vagrant-VMware-Utility"><a href="#安装Vagrant-VMware-Utility" class="headerlink" title="安装Vagrant VMware Utility"></a>安装Vagrant VMware Utility</h3><p>下载页<a target="_blank" rel="noopener" href="https://developer.hashicorp.com/vagrant/downloads/vmware">Install | Vagrant | HashiCorp Developer</a></p>
<p>windows10选择X86_64版本下载后双击安装。</p>
<h2 id="基础使用配置"><a href="#基础使用配置" class="headerlink" title="基础使用配置"></a>基础使用配置</h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>通过简单的几个vagrant命令即可快速初始化一个虚拟机</p>
<pre><code class="hljs shell">mkdir centos7_1
cd centos7_1
vagrant init
vagrant up</code></pre>

<h1 id="lt-lt-lt-lt-lt-lt-lt-HEAD-问题集合"><a href="#lt-lt-lt-lt-lt-lt-lt-HEAD-问题集合" class="headerlink" title="&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD### 问题集合"></a>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<br>### 问题集合</h1><h3 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h3><pre><code class="hljs shell">vagrant up #启动：，状态是 running

vagrant halt #停止：状态是 poweroff

vagrant suspend #暂停：状态是 saved

vagrant reload #重启：状态是 running 命令 reload 是先关闭，再开启

vagrant destroy #销毁：状态是 not created</code></pre>

<h3 id="时间同步"><a href="#时间同步" class="headerlink" title="时间同步"></a>时间同步</h3><blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>228ea1bf0a6fba68ec563ecd720756c6d6913775</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<h4 id="vagrant-up报错：Vagrant-encountered-an-error-while-attempting-to-load-the-utility-service-key-file"><a href="#vagrant-up报错：Vagrant-encountered-an-error-while-attempting-to-load-the-utility-service-key-file" class="headerlink" title="vagrant up报错：Vagrant encountered an error while attempting to load the utility service key file."></a>vagrant up报错：Vagrant encountered an error while attempting to load the utility service key file.</h4><p>Vagrant encountered an error while attempting to load the utility<br>service key file. This error can occur if the Vagrant VMware Utility<br>has not yet been installed, or if it was installed incorrectly. If<br>this error persists after running the Vagrant VMware Utility installer<br>again, please contact support at: <a href="mailto:&#x73;&#x75;&#x70;&#112;&#x6f;&#x72;&#116;&#x40;&#x68;&#x61;&#115;&#x68;&#x69;&#x63;&#x6f;&#114;&#x70;&#x2e;&#x63;&#111;&#109;">&#x73;&#x75;&#x70;&#112;&#x6f;&#x72;&#116;&#x40;&#x68;&#x61;&#115;&#x68;&#x69;&#x63;&#x6f;&#114;&#x70;&#x2e;&#x63;&#111;&#109;</a></p>
<p>Information about the Vagrant VMware Utility, including installation<br>instruction, can be found here:</p>
<p>  <a target="_blank" rel="noopener" href="https://www.vagrantup.com/docs/vmware/vagrant-vmware-utility.html">https://www.vagrantup.com/docs/vmware/vagrant-vmware-utility.html</a></p>
<p>  Path:  C:&#x2F;ProgramData&#x2F;hashicorp&#x2F;vagrant-vmware-desktop&#x2F;certificates&#x2F;vagrant-utility.client.crt<br>  Error: No such file or directory @ rb_sysopen - C:&#x2F;ProgramData&#x2F;hashicorp&#x2F;vagrant-vmware-desktop&#x2F;certificates&#x2F;vagrant-utility.client.crt</p>
<p><strong>原因：</strong></p>
<p>未安装Vagrant VMware Utility。</p>
<p><strong>解决</strong>：</p>
<p>参考上面安装Vagrant Vmware Utility</p>
<h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><p><code>vagrant up</code>启动虚拟机后，可通过</p>
<pre><code class="hljs shell">vagrant ssh</code></pre>

<p>ssh连接虚拟机，去除了繁杂的密码密钥等，交由vagrant管理。</p>
<h3 id="配置网络"><a href="#配置网络" class="headerlink" title="配置网络"></a>配置网络</h3><p>配置<code>hostname</code></p>
<pre><code class="hljs shell">config.vm.hostname = &quot;centos01&quot;</code></pre>

<h3 id="配置ip"><a href="#配置ip" class="headerlink" title="配置ip"></a>配置ip</h3><p>由于VirtualBox默认的虚拟机策略为网络地址转换，此策略对于后续的程序安装，需要访问时，都得转换一次端口，较为麻烦。为给虚拟机分配一个独有的ip地址，可通过vagrant配置文件指定。编辑虚拟机的Vagrantfile文件，加入如下行</p>
<p><code>hostname: true</code>启用hostname</p>
<pre><code class="hljs shell">config.vm.network &quot;public_network&quot;, ip: &quot;192.168.1.10&quot;, hostname: true</code></pre>

<p>保存后，执行<code>vagrant reload</code>命令重新加载配置，通过<code>ip addr</code>命令可查看虚拟机当前ip地址</p>
<h3 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h3><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">初始化一个vagrant镜像</span>
vagrant init
<span class="hljs-meta prompt_"># </span><span class="language-bash">启动vagrant镜像</span>
vagrant up
<span class="hljs-meta prompt_"># </span><span class="language-bash">重新加载配置，用于修改vagrantfile后</span>
vagrant reload</code></pre>

<h3 id="查看端口监听"><a href="#查看端口监听" class="headerlink" title="查看端口监听"></a>查看端口监听</h3><pre><code class="hljs shell">sudo netstat -ntalp | grep 80</code></pre>

<h2 id="问题合集"><a href="#问题合集" class="headerlink" title="问题合集"></a>问题合集</h2><h3 id="1-vagrant-up-faild、在线安装慢"><a href="#1-vagrant-up-faild、在线安装慢" class="headerlink" title="1. vagrant up faild、在线安装慢"></a>1. vagrant up faild、在线安装慢</h3><p>在首次执行vagrant up时需要下载centOS镜像，由于网络问题可能会下载失败或者下载很慢。这时候可以手动把镜像下载到本地，再通过add命令加载镜像到vagrant，再使用up命令即可跳过下载步骤</p>
<p>镜像搜索：<a target="_blank" rel="noopener" href="https://app.vagrantup.com/boxes/search">https://app.vagrantup.com/boxes/search</a></p>
<p>Centos&#x2F;7：<a target="_blank" rel="noopener" href="https://app.vagrantup.com/centos/boxes/7">https://app.vagrantup.com/centos/boxes/7</a></p>
<p>下载镜像后通过命令添加到vagrant：</p>
<pre><code class="hljs shell">vagrant add 镜像名 路径
<span class="hljs-meta prompt_">#</span><span class="language-bash">例如 vagrant box add centos/7 ./CentOS-7-x86_64-Vagrant-2004_01.VirtualBox.box</span></code></pre>

<p>此时再通过<code>vagrant up</code>命令安装启动虚拟机就不需要下载了，速度较快，推荐</p>
<h2 id="2-code-NS-ERROR-FAILURE-0x80004005-component-ConsoleWrap-interface-IConsole"><a href="#2-code-NS-ERROR-FAILURE-0x80004005-component-ConsoleWrap-interface-IConsole" class="headerlink" title="2.code NS_ERROR_FAILURE (0x80004005), component ConsoleWrap, interface IConsole"></a>2.code NS_ERROR_FAILURE (0x80004005), component ConsoleWrap, interface IConsole</h2><pre><code class="hljs shell">There was an error while executing `VBoxManage`, a CLI used by Vagrant
for controlling VirtualBox. The command and stderr is shown below.

Command: [&quot;startvm&quot;, &quot;605c2e37-9c5a-48fc-8884-26c9160bdf3d&quot;, &quot;--type&quot;, &quot;headless&quot;]

Stderr: VBoxManage: error: hv_vm_create() failed: 0xfae94001 (VERR_NEM_INIT_FAILED).
VBoxManage: error: Driverless mode (VERR_SUP_DRIVERLESS)
VBoxManage: error: Details: code NS_ERROR_FAILURE (0x80004005), component ConsoleWrap, interface IConsole</code></pre>

<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" 
  class="img-loading" data-original="https://typoradrawingbed.oss-cn-guangzhou.aliyuncs.com/img/202211102230280.png"" alt="截屏2022-11-10 22.29.15"></p>
<p>原因之一：AMD好像只支持到6.1的vbox，卸载7.0安装6.1的，然后在隐私项勾选oracle，确认重启搞定。</p>
<h2 id="Is-the-docker-daemon-running"><a href="#Is-the-docker-daemon-running" class="headerlink" title="Is the docker daemon running?"></a>Is the docker daemon running?</h2><p>docker服务未启动，</p>
<pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">启动docker</span>
service start docker
<span class="hljs-meta prompt_">#</span><span class="language-bash">开机自启</span>
sudo systemctl enable docker</code></pre>

<h3 id="3-ping-time-out"><a href="#3-ping-time-out" class="headerlink" title="3.ping time out"></a>3.ping time out</h3><p>配置了ip无法连接，检查配置的ip是否和主机处于同一网段</p>
</div></article><div class="copyright-wrapper"><p>原文作者:<a href="https://ainexur.github.io">ainexur</a></p><p>原文链接:<a href="https://ainexur.github.io/2022/08/27/vagrant%E6%8C%87%E5%8C%97/">vagrant指北</a></p><p>发表日期: 2022-08-27 12:36:37</p><p>更新日期: 2023-04-02 23:52:57</p><p>版权声明: 本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p></div><div class="post-pager"><div class="prev"><a href="/2022/10/24/kuangbin%E4%B8%93%E9%A2%98/" title="kuangbin专题">上一篇 kuangbin专题</a></div><div class="next"> <a href="/2022/06/30/%E6%9C%BA%E8%80%83%E5%9F%BA%E7%A1%80%E9%A2%98%E8%A7%A3/" title="机考基础题解">下一篇 机考基础题解</a></div></div><link rel="stylesheet" href="https://cdn.staticfile.org/gitalk/1.7.2/gitalk.min.css"/><script src="https://cdn.staticfile.org/gitalk/1.7.2/gitalk.min.js"></script><div id="gitalk-container"></div><script>new Gitalk({
  clientID: '',
  clientSecret: '',
  repo: '',
  owner: '',
  admin: '',
  id: location.pathname.substr(0, 48),
  distractionFreeMode: true,
  labels: ['Gitalk'],
  title: 'vagrant指北',
}).render('gitalk-container');</script></section></section></main><footer class="footer-page"><div><span>Powered by</span><a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a><span>| Theme</span><a target="_blank" rel="noopener" href="https://github.com/techmovie/hexo-theme-instapaper">instapaper</a></div></footer><script src="/scripts/dark.js"></script><script src="/scripts/post.js"></script></body></html>